<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap core CSS -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="static/css/opencitations/cover.css" rel="stylesheet">

    <!--<link href="https://opencitations.github.io/oscar/static/css/search.css" rel="stylesheet">-->
    <link href="static/css/search.css" rel="stylesheet">
    <link href="static/css/browser.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;700&display=swap" rel="stylesheet">

  </head>

<!-- BODY
================================================== -->
  <body>
    <div class="banner_oc">
      <nav>
        <ul>
          <li data-html="true" data-container="body" data-toggle="tooltip" data-placement="right" id="home" title="homepage"><a href="http://opencitations.net/ccc" target="_blank"><img id="oc_logo" src="static/img/logo.png" alt="opencitations logo"/> </a> </li>
          <li data-html="true" data-container="body" data-toggle="tooltip" data-placement="right" id="search_ccc" title="search">
            <a id="search_oscar_menu" href="http://opencitations.net/ccc/search" target="_blank">
              <img id="search_link" src="static/img/search.png" alt="search in ccc corpus"/>
            </a>
            <!--
            <div id="search_and_results" class="overlay">
              <span class="closebtn" id="closebtn" title="close search">Ã—</span>
              <div class="overlay-content">
                <form action="browser-corpus.html" onsubmit="ccc_menu_search()" method="GET" accept-charset="ASCII">
                    <input id="input_box" name="query" name="input_box" type="text" autocomplete="on" class="form-control oc-purple" placeholder="Search...">
                </form>
                </div>
            </div> -->

          </li>
          <li data-html="true" data-container="body" data-toggle="tooltip" data-placement="right" id="share" title="share"><a href="https://twitter.com/share?ref_src=twsrc%5Etfw"  target="_blank" data-show-count="false"><img src="static/img/twitter.svg" alt=""> </a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></li>
          <li data-html="true" data-container="body" data-toggle="tooltip" data-placement="right" id="terms" title="Data held in the <a href='http://opencitations.net/ccc/'>CCC</a> are freely available under a <a href='https://creativecommons.org/publicdomain/zero/1.0/'>CC0 license</a>. The full-text of sentences is not stored, and it is available under publishers' licenses."><img src="static/img/security.png" alt="legal terms for data reuse"></li>
        </ul>
      </nav>
    </div>
    <div class="__lucinda__ container-fluid" data-content="header details metrics"></div>
    <div class="cover __oscar__ col-md-10" data-type="free-text" data-view="rows_per_page sort_results" data-filter=""></div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>


    <!-- we integrate also the search module -->
    <!-- <script type="text/javascript" src="https://opencitations.github.io/oscar/example/v2/static/js/search-conf-occ.js"></script> -->
    <script type="text/javascript" src="static/js/search-conf-occ.js"></script>
    <!-- <script type="text/javascript" src="https://opencitations.github.io/oscar/static/js/search.js"></script> -->
    <script type="text/javascript" src="static/js/search.js"></script>
    <script type="text/javascript" src="static/js/browser-conf-corpus.js"></script>
    <script type="text/javascript" src="static/js/browser.js"></script>
    <script type="text/javascript" src ="static/js/jquery.mark.min.js"></script>
    <script type="text/javascript" src ="static/js/underscore-min.js"></script>
    <script type="text/javascript" src ="static/js/epmc.js"></script>
    <script src="static/js/d3.v6.min.js"></script>
    <script type="text/javascript" src ="static/js/ramose.js"></script>
    <script>
      // search menu
      // $(document).on("click", "#search_oscar_menu", function(event) {
      //   event.preventDefault();
      //   $("#search_and_results").css("display", "block").css("opacity", "1");
      //   $(".__lucinda__,#browser_metrics").css("display","none");
      //   var detached = $(".cover.__oscar__").detach();
      //   $(".overlay-content").append('<div class="menu __oscar__" data-type="free-text" data-view="rows_per_page sort_results" data-filter=""></div>');
      //
      //   $(document).on("click", "#closebtn", function(event) {
      //     var detached_menu = $(".menu.__oscar__").detach();
      //     event.preventDefault();
      //     document.getElementById("search_and_results").style.display = "none";
      //     $(".__lucinda__, .__oscar__,#browser_metrics").css("display","block");
      //     $(".__lucinda__").after(detached);
      //   });
      // });
      //
      // function ccc_menu_search() {
      //   event.preventDefault();
      //   search_conf["search_base_path"] = "browser-corpus.html";
      //   search_conf["advanced_search"] = false;
      //   var query_term = decodeURIComponent(document.getElementById("input_box").value).replace(/\+/g, '%20');
      //   search.do_sparql_query(query_term);
      //   console.log(query_term);
      // };

      // cursor
      $(document).ajaxStart(function() {
          $(document.body).css({'cursor' : 'wait'});
      }).ajaxStop(function() {
          $(document.body).css({'cursor' : 'default'});
      });

      // lucinda
      var resource_iri = null;
      var myRegexp = /browser-corpus\.html\?browse=(.*)/g;
      var groups = myRegexp.exec(String(window.location.href));
      if (groups.length > 1) {resource_iri = groups[1];}
      browser.do_sparql_query(resource_iri);

      var resize = true;
      // graphs sidebar
      $(document).on("click", ".know_more", function(event) {

        if ( $(".graph_block").length == 0) {
          document.body.style.cursor = 'wait';
          var doi = $(".doi_before > a").attr('href').split('doi.org/')[1] ;
          var data_citations = call_ramose_citations(doi);
          citations_by_year(data_citations[0]);
          //self_citations(data_citations[1]);
          citation_venues(data_citations[2]);
          //citing_authors(data_citations[2]);

          document.body.style.cursor = 'auto';
        } else {
          $(".graph_block").toggle();
        };

        $("#browser_metrics").css("z-index","20000");
        $("#browser_metrics").toggleClass("col-md-2 col-md-4",1000, "easeOutSine");
        $("#browser_info").toggleClass("col-md-10 col-md-8",1000, "easeOutSine");
        if (resize) {
          $('.__oscar__').animate({"width":"55%"},800);
          $("#rows_per_page").css("width", "36%");
          $(".know_more").text("read less");
          resize = false;
        } else {
          $('.__oscar__').animate({"width":"70%"},1000);
          $(".know_more").text("read more");
          $("#rows_per_page").css("width", "30%");
          resize = true;
        }
        //$(".__oscar__").width() == "70%" ? "55%" : "70%";
        // $(".__oscar__").css("width", "55%");
        // $(".__oscar__").toggleClass("col-md-10 col-md-6",1000, "easeOutSine");
        // $('.__oscar__').toggle(
        //   function() { $('.__oscar__').css("width","55%"); },
        //   function() { $('.__oscar__').css("width","70%"); }
        // );

      } );

      // popup menu
      $("#home").tooltip();
      $("#terms").tooltip();
      $("#search_ccc").tooltip();
      $("#share").tooltip();

      // CCC call EPMC for in-text citations
      $(document).on("click", "td[field='mentions']>a", function(event) {
          event.preventDefault();
          var pointers = $(this).attr('href');
          var td = $(this).parent();

          // toggle sentences
          if ( $(td).next("td").length != 0) {
              $(td).next("td").toggle();
          } else {
            var new_td = expand_context(td,pointers)[0]
              , rp_content = expand_context(td,pointers)[1];
            // append sentences
            $(td).parent().append(new_td);

            $(new_td).each(function(){
                $(this).hover(function(){
                  $(this).children('.sentence').each(function () {
                      var rp = rp_content[$(this).text()];
                      var options = {"separateWordSearch": false}
                      $(this).mark(rp, options);
                   });
                });
            });
          }

      });
      // default image for no results / no oscar calls
      if ( $('#search_results').is(':empty') ) {
        $("#search_results").append("<div class='no_results'><img src='static/img/poor.png'/></div>")
      }
    </script>
  </body>
</html>
